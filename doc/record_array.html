<!DOCTYPE html>

<html>
<head>
  <title>record_array.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>record_array.coffee</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="example-app.html">
                    example-app.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="emd.html">
                    emd.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="attr.html">
                    attr.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="belongs_to.html">
                    belongs_to.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="has_many.html">
                    has_many.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="moment.html">
                    moment.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="object.html">
                    object.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="initializer.html">
                    initializer.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="model.html">
                    model.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="record_array.html">
                    record_array.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="paged.html">
                    paged.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="relation.html">
                    relation.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="store.html">
                    store.coffee
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        
        
          <div class='highlight'><pre>EMD.RecordArray = Em.ArrayProxy.extend Em.Evented,

  ajax: EMD.Store.alias <span class="string">'ajax'</span>

  url: <span class="literal">null</span>
  query: <span class="literal">null</span>

  _model: (-&gt;
    model = <span class="property">@get</span> <span class="string">'model'</span>
    model.create()
  ).property()

  model: <span class="literal">null</span>

  isLoaded: ((_, set)-&gt;
    <span class="keyword">return</span> set <span class="keyword">if</span> set != <span class="literal">undefined</span>
    <span class="property">@_init</span>()
    <span class="literal">false</span>
  ).property()

  isLoading: ((_, set)-&gt;
    <span class="keyword">return</span> set <span class="keyword">if</span> set != <span class="literal">undefined</span>
    <span class="property">@_init</span>()
    <span class="literal">false</span>
  ).property()

  extractMeta: (rsp)-&gt;
    <span class="literal">null</span>

  success: (ok)-&gt;
    Em.assert <span class="string">"You must specify a model or a success converter"</span>, model = <span class="property">@get</span> <span class="string">'model'</span>
    model.fromJson ok

  error: (err, url, query)-&gt;
    <span class="keyword">debugger</span>

  content: ((_, set)-&gt;
    <span class="keyword">return</span> set <span class="keyword">if</span> set != <span class="literal">undefined</span>
    <span class="property">@_init</span>()
    []
  ).property()

  _init: -&gt;
    <span class="keyword">return</span> <span class="keyword">if</span> <span class="property">@_inited</span>
    <span class="property">@_inited</span> = <span class="literal">true</span>
    <span class="property">@_setupContent</span>()
    <span class="property">@_setupArrangedContent</span>()
    <span class="keyword">unless</span> <span class="property">@_initial_content_load</span>
      <span class="property">@_initial_content_load</span> = <span class="literal">true</span>
      <span class="property">@urlOrQueryDidChange</span>()

  init: -&gt;
    <span class="property">@_inited</span> = <span class="literal">false</span>
    <span class="property">@_initial_content_load</span> = <span class="literal">false</span>

  load: (fn)-&gt;
    <span class="keyword">return</span> fn.apply <span class="keyword">this</span> <span class="keyword">if</span> <span class="property">@get</span> <span class="string">"isLoaded"</span>
    <span class="property">@urlOrQueryDidChange</span>()
    <span class="property">@one</span> <span class="string">"load"</span>, @, fn
    @

  reload: (overrides = {})-&gt;
    <span class="property">@set</span> <span class="string">"query"</span>, $.extend({}, <span class="property">@get</span>(<span class="string">"query"</span>), overrides)

  urlOrQueryDidChange: ((_, change_key)-&gt;</pre></div>
        
      
        
        <p>Nobody asked for content!</p>

        
          <div class='highlight'><pre>    <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@_inited</span></pre></div>
        
      
        
        <p>Hmm... url not available? When does this happen again?</p>

        
          <div class='highlight'><pre>    <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@get</span> <span class="string">"_model.link"</span></pre></div>
        
      
        
        <p>no url?</p>

        
          <div class='highlight'><pre>    <span class="keyword">return</span> <span class="keyword">unless</span> url = <span class="property">@get</span> <span class="string">"url"</span></pre></div>
        
      
        
        <p>Protect against eager loading twice</p>

        
          <div class='highlight'><pre>    <span class="keyword">return</span> <span class="keyword">if</span> !change_key <span class="keyword">and</span> <span class="property">@get</span> <span class="string">'isLoading'</span>

    query = <span class="property">@get</span> <span class="string">"query"</span>
    <span class="property">@set</span> <span class="string">"isLoaded"</span>, <span class="literal">false</span>
    <span class="property">@set</span> <span class="string">"isLoading"</span>, <span class="literal">true</span>

    console.log <span class="string">"<span class="subst">#{@}</span>::<span class="subst">#{@get('model').toString()}</span>.loading(<span class="subst">#{change_key}</span>:<span class="subst">#{@get change_key <span class="keyword">if</span> change_key}</span>)"</span>, query

    <span class="property">@ajax</span>(
      method: <span class="string">"get"</span>
      url: url
      data: query
    ).success((ok)=&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> <span class="property">@isDestroyed</span>
      <span class="property">@extractMeta</span> ok
      <span class="property">@set</span> <span class="string">"content"</span>, <span class="property">@success</span> ok
      <span class="property">@set</span> <span class="string">"isLoaded"</span>, <span class="literal">true</span>
      <span class="property">@set</span> <span class="string">"isLoading"</span>, <span class="literal">false</span>
      <span class="property">@trigger</span> <span class="string">"load"</span>, @
    ).error((err)=&gt;
      <span class="property">@error</span> err, url, query
    )

  ).observes <span class="string">"query"</span>, <span class="string">"url"</span>, <span class="string">"_model.link"</span></pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
